# LECTURE7: How to Investigate a SIEM Alert?
## 1) Introduction to SIEM Alerts
>**ANSWER: CHECK**

## 2) Detection

### SIEM alerts:  
are notifications generated by the SIEM system based on predefined rules 
and correlation algorithms. These rules are typically customized to meet an organization's 
specific security requirements. When an event matches the defined criteria, the SIEM 
system triggers an alert.

### Playbooks: 
There are many different types of alerts (web attacks, ransomware, malware, phishing, etc.) 
in the SOC (Security Operations Centre) environment. The methods and approaches for 
investigating these alerts are different. Workflows for effective and consistent analysis of 
alerts generated by SIEM or other security tools are called playbooks.

### Why Are Playbooks Important?
As SOC analysts, we don't always know the exact steps to take when dealing with alerts. 
Playbooks help by providing a clear, step-by-step process to follow 
during an investigation. This is especially helpful for new analysts just starting their SOC careers.

### Alerts Types:
 * A true positive means that the alert is legitimate and requires further action,  
 * false positive means that the alert is a false alarm.

#### In which channel can you take ownership of the alert?
 >**ANSWER: main channel**
  #### Once you have completed the analysis of an alert, in which channel can you close the alert?
 >**ANSWER: Investigation channel**

## 3) Case Creation and Playbook Initiation

 Creating a case allows us to organize and track our investigation efforts, 
 while the playbook guides us through the necessary steps to effectively respond to the security incident.

### lets solve this chapter lab EventID: 257 - SOC282 - Phishing Alert - Deceptive Mail Detected 
 
1. Clicking on the "Take Ownership" button

![alt text](../Assets/lab7/1.png)
![alt text](../Assets/lab7/2.png)
As we can see, there is a phishing email alert. Let’s check it more closely.




2. Keep the playbook in a new tab because it shows us the steps to solve this lab 

![alt text](../Assets/lab7/3.png)

we should answer the playbook Questions 
* When was it sent?
* What is the email's SMTP address?
* What is the sender address?
* What is the recipient address?
* Is the mail content suspicious?
* Are there any attachment?




3. in the alert we have the SMTP Address 

![alt text](../Assets/lab7/1.png)
its 103.80.134.63




4. Now we enter the Email Security section from the left sidebar to check the email content 

![alt text](../Assets/lab7/4.png)
![alt text](../Assets/lab7/5.png)
Now we have the date the email was received and the content of the email.
It includes an attached file, along with the sender and recipient addresses.





5. Now let’s check if the attached file is malicious or not

We download it (the password is "infected").

![alt text](../Assets/lab7/6.png)
After extracting it, Windows Defender shows that it is a malicious file.


![alt text](../Assets/lab7/7.png)
It says the file is a backdoor virus.


![alt text](../Assets/lab7/9.png)
If we upload the file (RECOMMENDED) to [virustotal](https://www.virustotal.com/) it shows that it is 
malicious software classified as a trojan.




6. Now we have all the information we need. Let’s start closing the alert

![alt text](../Assets/lab7/8.png)
![alt text](../Assets/lab7/10.png)
![alt text](../Assets/lab7/11.png)




7. Let’s delete the email from the customer’s mailbox 
![alt text](../Assets/lab7/12.png)

Click the delete button in the top right corner. 
![alt text](../Assets/lab7/13.png)

![alt text](../Assets/lab7/14.png)




8. Let’s contain the user’s machine
![alt text](../Assets/lab7/15.png)




9. Go to the "EDR" page and contain the user’s machine

![alt text](../Assets/lab7/16.png)
Go to the EDR page and contain the user’s machine by searching for the victim’s address 172.16.20.3.

![alt text](../Assets/lab7/17.png)

![alt text](../Assets/lab7/18.png)

![alt text](../Assets/lab7/19.png)
true positive alert !!




### Questions :

#### What is the “type” of the alert?
>**ANSWER: Exchange**
#### When was the alert generated?
>**ANSWER: May, 13, 2024, 09:22 AM**
#### What is the email's SMTP address?
>**ANSWER: 103.80.134.63**
#### What is the source address?
>**ANSWER: free@coffeeshooop.com**
#### What is the destination address?
>**ANSWER: Felix@letsdefend.io**


## 4) Email Analysis

Fill in the following fields as needed:
* Sender
* Recipient
* Subject
* Sender IP Address
* Attachment Name
* Email Body
* Date
* Action

Once you've found the email in question, examine it to find 
the answers to the last two questions in the first step of the playbook.
* Is the content of the email suspicious?
* Are there any attachments?

You can use the following free products/services:

* AnyRun : An interactive malware analysis service, sandbox.
* VirusTotal : A service that analyzes files and URLs for viruses.
* URLHouse : A database of malicious URLs.
* URLScan : A tool for scanning and analyzing websites.
* HybridAnalysis : A free malware analysis service.Sandbox 

: “ https://app.letsdefend.io/sandbox ”

#### What is the name of the attachment?
>**ANSWER: free-Coffee.zip**
#### What is the subject of the email?
>**ANSWER: Free Coffee Voucher**
#### When was the email sent?
>**ANSWER: May, 13, 2024, 09:22 AM**

## 5) Network and Log Analysis
we check it To determine if the user has executed the file 
they have downloaded, this step is critical.


Determine Access Status:
* Click the Raw Data button to view the raw log of the specified entry. 
Determine whether the malicious file or URL was accessed.

Threat Intel
* analyze Indicators of Compromise (IOCs). This tab aggregates data from various threat intelligence sources to 
identify malicious IP addresses, domains, or URLs. Here you 
can search for the IOCs you've found during your investigation.

#### What is the IP address of the Felix host?
>**ANSWER: 172.16.20.151**
#### When exactly did Felix download the malicious file?
>**ANSWER: May, 13, 2024, 12:59 PM**
#### What is the C2 address?
>**ANSWER:  37.120.233.226**
#### What’s the name of the process that communicated with C2?
>**ANSWER: coffee.exe**
#### What port did the malware use to communicate?
>**ANSWER: 3451**

## 6) Endpoint Analysis
its involves examining the processes and browser activity on the affected endpoints to 
identify any further indicators of compromise.

* Endpoint Detection and Response (EDR) such as Carbon Black, SentinelOne, CrowdStrike

* Process and network action analysis aims to detect suspicious processes and identify 
communication with command and control addresses.

Terminal and Browser History:
* Check the terminal history to identify suspicious commands executed on the host.
* Examine the browser history to identify any visits to malicious websites or download links.

#### What is the Process ID (PID) of the “coffee.exe”?
>**Answer: 6697**
#### What is the “image hash” of the malicious process?
>**Answer: CD903AD2211CF7D166646D75E57FB866000F4A3B870B5EC759929BE2FD81D334**
#### How many child processes does “cmd.exe” have?
>**Answer: 7**

## 7) results 
#### On the monitoring page, through which channel can you access the official incident report of an alert?
>**Answer: Closed alerts**
